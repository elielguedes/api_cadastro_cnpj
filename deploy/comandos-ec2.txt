# Comandos para conectar na instância EC2 e fazer deploy

# 1. Navegar para a pasta onde está a chave
cd $env:USERPROFILE\Downloads

# 2. Conectar na instância (digite 'yes' quando perguntado)
ssh -i fastapi_app_key.pem ubuntu@18.118.167.28

# 3. Depois que conectar na instância, execute no terminal da EC2:

# Atualizar sistema
sudo apt update -y

# Instalar dependências básicas
sudo apt install -y git python3 python3-pip python3-venv nginx

# Clonar o repositório
git clone https://github.com/elielguedes/Relatorio_Eliel_Guedes.git

# Entrar na pasta do projeto
cd Relatorio_Eliel_Guedes

# Verificar se os arquivos de deploy existem
ls deploy/

# Criar ambiente virtual
python3 -m venv venv
source venv/bin/activate

# Instalar dependências Python
pip install -r requirements.txt
pip install gunicorn

# Configurar variável de ambiente
export PYTHONPATH="/home/ubuntu/Relatorio_Eliel_Guedes"

# Aplicar migrations
python -m alembic upgrade head

# Testar se a aplicação funciona
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000